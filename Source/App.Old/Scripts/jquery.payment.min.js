((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[].slice,u=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},v=this;a=jQuery,a.payment={},a.payment.fn={},a.fn.payment=function(){var b,c;return c=arguments[0],b=2<=arguments.length?t.call(arguments,1):[],a.payment.fn[c].apply(this,b)},e=/(\d{1,4})/g,d=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:e,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:e,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:e,length:[13,14,15,16],cvcLength:[3],luhn:!0}],b=function(a){var b,c,e;a=(a+"").replace(/\D/g,"");for(c=0,e=d.length;c<e;c++){b=d[c];if(b.pattern.test(a))return b}},c=function(a){var b,c,e;for(c=0,e=d.length;c<e;c++){b=d[c];if(b.type===a)return b}},m=function(a){var b,c,d,e,f,g;d=!0,e=0,c=(a+"").split("").reverse();for(f=0,g=c.length;f<g;f++){b=c[f],b=parseInt(b,10);if(d=!d)b*=2;b>9&&(b-=9),e+=b}return e%10===0},l=function(a){var b;return a.prop("selectionStart")!=null&&a.prop("selectionStart")!==a.prop("selectionEnd")?!0:(typeof document!="undefined"&&document!==null?(b=document.selection)!=null?typeof b.createRange=="function"?b.createRange().text:void 0:void 0:void 0)?!0:!1},n=function(b){var c=this;return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=a.payment.formatCardNumber(d),c.val(d)})},h=function(c){var d,e,f,g,h,i,j;f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;d=a(c.currentTarget),j=d.val(),e=b(j+f),g=(j.replace(/\D/g,"")+f).length,i=16,e&&(i=e.length[e.length.length-1]);if(g>=i)return;if(d.prop("selectionStart")!=null&&d.prop("selectionStart")!==j.length)return;e&&e.type==="amex"?h=/^(\d{4}|\d{4}\s\d{6})$/:h=/(?:^|\s)(\d{4})$/;if(h.test(j))return c.preventDefault(),d.val(j+" "+f);if(h.test(j+f))return c.preventDefault(),d.val(j+f+" ")},f=function(b){var c,d;c=a(b.currentTarget),d=c.val();if(b.meta)return;if(b.which!==8)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(/\d\s$/.test(d))return b.preventDefault(),c.val(d.replace(/\d\s$/,""));if(/\s\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\d?$/,""))},i=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val()+d;if(/^\d$/.test(e)&&e!=="0"&&e!=="1")return b.preventDefault(),c.val("0"+e+" / ");if(/^\d\d$/.test(e))return b.preventDefault(),c.val(""+e+" / ")},j=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val();if(/^\d\d$/.test(e))return c.val(""+e+" / ")},k=function(b){var c,d,e;d=String.fromCharCode(b.which);if(d!=="/")return;c=a(b.currentTarget),e=c.val();if(/^\d$/.test(e)&&e!=="0")return c.val("0"+e+" / ")},g=function(b){var c,d;if(b.meta)return;c=a(b.currentTarget),d=c.val();if(b.which!==8)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(/\d(\s|\/)+$/.test(d))return b.preventDefault(),c.val(d.replace(/\d(\s|\/)*$/,""));if(/\s\/\s?\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\/\s?\d?$/,""))},r=function(a){var b;return a.metaKey||a.ctrlKey?!0:a.which===32?!1:a.which===0?!0:a.which<33?!0:(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b))},p=function(c){var d,e,f,g;d=a(c.currentTarget),f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;if(l(d))return;return g=(d.val()+f).replace(/\D/g,""),e=b(g),e?g.length<=e.length[e.length.length-1]:g.length<=16},q=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;if(l(c))return;e=c.val()+d,e=e.replace(/\D/g,"");if(e.length>6)return!1},o=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;return e=c.val()+d,e.length<=4},s=function(b){var c,e,f,g,h;c=a(b.currentTarget),h=c.val(),g=a.payment.cardType(h)||"unknown";if(!c.hasClass(g))return e=function(){var a,b,c;c=[];for(a=0,b=d.length;a<b;a++)f=d[a],c.push(f.type);return c}(),c.removeClass("unknown"),c.removeClass(e.join(" ")),c.addClass(g),c.toggleClass("identified",g!=="unknown"),c.trigger("payment.cardType",g)},a.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",o),this},a.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",q),this.on("keypress",i),this.on("keypress",k),this.on("keypress",j),this.on("keydown",g),this},a.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",p),this.on("keypress",h),this.on("keydown",f),this.on("keyup",s),this.on("paste",n),this},a.payment.fn.restrictNumeric=function(){return this.on("keypress",r),this},a.payment.fn.cardExpiryVal=function(){return a.payment.cardExpiryVal(a(this).val())},a.payment.cardExpiryVal=function(a){var b,c,d,e;return a=a.replace(/\s/g,""),e=a.split("/",2),b=e[0],d=e[1],(d!=null?d.length:void 0)===2&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),/^\d+$/.test(a)?(c=b(a),c?(d=a.length,u.call(c.length,d)>=0)&&(c.luhn===!1||m(a)):!1):!1},a.payment.validateCardExpiry=function(b,c){var d,e,f,g;return typeof b=="object"&&"month"in b&&(g=b,b=g.month,c=g.year),!b||!c?!1:(b=a.trim(b),c=a.trim(c),/^\d+$/.test(b)?/^\d+$/.test(c)?parseInt(b,10)<=12?(c.length===2&&(f=(new Date).getFullYear(),f=f.toString().slice(0,2),c=f+c),e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1:!1:!1)},a.payment.validateCardCVC=function(b,d){var e,f;return b=a.trim(b),/^\d+$/.test(b)?d?(e=b.length,u.call((f=c(d))!=null?f.cvcLength:void 0,e)>=0):b.length>=3&&b.length<=4:!1},a.payment.cardType=function(a){var c;return a?((c=b(a))!=null?c.type:void 0)||null:null},a.payment.formatCardNumber=function(a){var c,d,e,f;return c=b(a),c?(e=c.length[c.length.length-1],a=a.replace(/\D/g,""),a=a.slice(0,+e+1||9e9),c.format.global?(f=a.match(c.format))!=null?f.join(" "):void 0:(d=c.format.exec(a),d!=null&&d.shift(),d!=null?d.join(" "):void 0)):a}})).call(this)